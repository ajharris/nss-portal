{% extends "base.html" %}
{% from "bootstrap/wtf.html" import form_field %}

{% block page_content %}
<div class="container">
    <h2>Event: {{ event.showName }}</h2>

    {% if current_user.is_admin or current_user.is_account_manager %}
    <div id="request-crew-section">
        <h3>Request Crew</h3>
        <form method="POST" action="{{ url_for('events.view_event', event_id=event.id) }}">
            {{ crew_request_form.hidden_tag() }}
            <div class="form-group">
                {{ form_field(crew_request_form.description, class="form-control") }}
            </div>
            <div class="form-row">
                <div class="form-group col-md-4">
                    {{ form_field(crew_request_form.start_time, class="form-control datetimepicker") }}
                </div>
                <div class="form-group col-md-4">
                    {{ form_field(crew_request_form.end_time, class="form-control datetimepicker") }}
                </div>
                <div class="form-group col-md-4">
                    <label>Shift Type</label>
                    <div class="horizontal-checkbox-group">
                        {% for shift in crew_request_form.shiftType %}
                            <div class="form-check form-check-inline">
                                {{ shift(class="form-check-input") }}
                                <label class="form-check-label">{{ shift.label }}</label>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Roles</label>
                <div class="horizontal-role-group">
                    {% for role, count in roles.items() %}
                        <div class="form-group role-entry">
                            <label>{{ role }}</label>
                            <input type="number" name="{{ role }}" value="{{ count }}" class="form-control">
                        </div>
                    {% endfor %}
                </div>
            </div>
            <div class="form-group">
                {{ form_field(crew_request_form.submit, class="btn btn-primary") }}
            </div>
        </form>
    </div>
    {% endif %}

    {% for crew_id, crew in crew_assignments.items() %}
    <div class="crew-report">
        <h4>{{ crew.description }}</h4>
        <div class="form-row">
            <div class="form-group col-md-4">
                <p><strong>Start Time:</strong> {{ crew.start_time }}</p>
            </div>
            <div class="form-group col-md-4">
                <p><strong>End Time:</strong> {{ crew.end_time }}</p>
            </div>
            <div class="form-group col-md-4">
                <p><strong>Shift Type:</strong> {{ crew.shift_type | capitalize }}</p>
            </div>
        </div>
        <table class="table">
            <thead>
                <tr>
                    <th>Role</th>
                    <th>Name</th>
                    <th>Phone</th>
                    <th>Email</th>
                </tr>
            </thead>
            <tbody>
                {% for role, details in crew.assignments.items() %}
                <tr>
                    <td>{{ role }}</td>
                    <td>{{ details.name }}</td>
                    <td>{{ details.phone }}</td>
                    <td>{{ details.email }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <form method="POST" action="{{ url_for('events.delete_crew', crew_id=crew_id) }}">
            {{ crew_request_form.hidden_tag() }}
            <button type="submit" class="btn btn-danger">Delete</button>
        </form>
    </div>
    {% endfor %}

    <h3>Notes</h3>
    <form method="POST" action="{{ url_for('events.view_event', event_id=event.id) }}">
        {{ note_form.hidden_tag() }}
        <div class="form-group">
            {{ form_field(note_form.notes, class="form-control") }}
        </div>
        <div class="form-group">
            {{ form_field(note_form.submit, class="btn btn-primary") }}
        </div>
    </form>

    <h3>Documents</h3>
    <form method="POST" enctype="multipart/form-data" action="{{ url_for('events.view_event', event_id=event.id) }}">
        {{ document_form.hidden_tag() }}
        <div class="form-group">
            {{ form_field(document_form.document, class="form-control") }}
        </div>
        <div class="form-group">
            {{ form_field(document_form.submit, class="btn btn-primary") }}
        </div>
    </form>

    <h3>SharePoint</h3>
    <form method="POST" action="{{ url_for('events.view_event', event_id=event.id) }}">
        {{ sharepoint_form.hidden_tag() }}
        <div class="form-group">
            {{ form_field(sharepoint_form.sharepoint_link, class="form-control") }}
        </div>
        <div class="form-group">
            {{ form_field(sharepoint_form.submit, class="btn btn-primary") }}
        </div>
    </form>
</div>

<style>
    .horizontal-role-group {
        display: flex;
        flex-wrap: wrap;
    }
    .role-entry {
        flex: 1;
        min-width: 200px;
        margin-bottom: 15px;
    }
    .form-check-inline {
        margin-right: 15px;
        margin-bottom: 10px;
    }
    .crew-report {
        margin-top: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid #ddd;
    }
    .crew-report form {
        display: inline;
    }
    .crew-report form button {
        margin-top: 10px;
    }
</style>
{% endblock %}
